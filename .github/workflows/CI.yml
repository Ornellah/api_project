name: CI
on: [push]
jobs:
  install-dependencies:
    name: Install dependencies ğŸ—ï¸
    runs-on: ubuntu-latest
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
      - name: dependencies install 
        uses: actions/setup-python@v4
        with: 
          python-version: "3.10"
          cache: 'pip' 
      - run: |
          pip install -r requirements.txt 
          npm install -g wait-on

  unit-tests:
    needs: install-dependencies
    name: Run tests ğŸ§ª
    runs-on: ubuntu-latest
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: dependencies install 
        uses: actions/setup-python@v4
        with: 
          python-version: "3.10"
          cache: 'pip' 
      - run: |
          pip install -r requirements.txt 
          npm install -g wait-on
      - name: build docker image
        run : 
          docker build -t test_ho .
      - name: run docker image
        run :
          docker run -p 5000:5000 -d test_ho
      - name: Run tests
        run : 
          wait-on http://127.0.0.1:5000/ && pytest

  run-linters:
    needs: [install-dependencies,unit-tests]
    name: Run linter ğŸ’„
    runs-on: ubuntu-latest
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
      - name: Install Python dependencies
        run: pip install black flake8
      - name: Run linters
        uses: wearerequired/lint-action@v2
        with:
          github_token: ${{ secrets.github_token }}
          black: true
          flake8: true

 